<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Admin Paneli</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
<script defer src="app.js"></script>
</head>
<body class="bg-light">
<div class="container py-4">

<!-- Admin Girişi -->
<div id="adminLoginCard" class="card p-3 my-3">
<h3>Admin Girişi</h3>
<input type="text" class="form-control mb-2" id="adminUser" placeholder="Kullanıcı Adı">
<input type="password" class="form-control mb-2" id="adminPass" placeholder="Şifre">
<button id="loginBtn" class="btn btn-danger">Giriş Yap</button>
</div>

<!-- Admin Paneli -->
<div id="adminPanel" style="display:none;">
<h2>Admin Paneli</h2>

<!-- QR Kod Okuma -->
<div class="card p-3 my-3">
<h4>QR Kod Okuma</h4>
<button id="startQrBtn" class="btn btn-primary mb-2">QR Okut</button>
<div id="qr-reader" style="width:100%; max-width:400px; margin:auto;"></div>
<div id="qr-result" class="mt-2"></div>
</div>

<!-- Yeni Sanatçı Ekle -->
<div class="card p-3 my-3">
<h4>Yeni Sanatçı Ekle</h4>
<input type="text" class="form-control mb-2" id="artistName" placeholder="İsim">
<input type="email" class="form-control mb-2" id="artistEmail" placeholder="Email">
<input type="text" class="form-control mb-2" id="artistPhone" placeholder="Telefon">
<input type="text" class="form-control mb-2" id="artistPass" placeholder="Şifre">
<input type="number" class="form-control mb-2" id="artistTarget" placeholder="Bilet Hedefi">
<button id="addArtistBtn" class="btn btn-primary">Sanatçı Ekle</button>
</div>

<!-- Sanatçılar -->
<div class="card p-3 my-3">
<h4>Sanatçılar</h4>
<div id="artistList"></div>
</div>

<!-- Okunan Biletler -->
<div class="card p-3 my-3">
<h4>Okunan Biletler</h4>
<button id="clearHistory" class="btn btn-danger mb-2">Geçmişi Temizle</button>
<table class="table table-sm table-striped">
<thead><tr><th>ID</th><th>Sanatçı</th><th>Müşteri</th><th>Tarih</th></tr></thead>
<tbody id="ticketHistory"></tbody>
</table>
</div>

</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  let qrScanner = null;

  const startBtn = document.getElementById("startQrBtn");
  startBtn.addEventListener("click", () => {
    if(qrScanner){ qrScanner.stop().catch(()=>{}); qrScanner.clear(); }

    qrScanner = new Html5Qrcode("qr-reader");

    qrScanner.start(
      { facingMode: "environment" },
      { fps: 10, qrbox: 250 },
      decoded => {
        document.getElementById("qr-result").innerText = `Bilet ID: ${decoded}`;
        // Burada verifyTicket(decoded) çağırabilirsin
        alert(`Bilet ID: ${decoded}`);
        qrScanner.stop(); // Okuduktan sonra durdur
      },
      err => {
        console.warn(err);
      }
    ).catch(err => console.error("QR başlatılamadı:", err));
  });
});
</script>

</body>
</html>
